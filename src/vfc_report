#!/usr/bin/env python3
import numpy as np
import pandas as pd 
import matplotlib.pyplot as plt
import random
import math
import sys
import struct
import shlex
import os.path
import subprocess
from os import listdir

def GetFunctionInfo(FunctionID):
	CallNb = int(FunctionID[FunctionID.rfind('_')+1:])
	FunctionID = FunctionID[:FunctionID.rfind('_')]
	Fline = int(FunctionID[FunctionID.rfind('_')+1:])
	FunctionID = FunctionID[:FunctionID.rfind('_')]
	Fname = FunctionID[FunctionID.rfind('/')+1:]
	FunctionID = FunctionID[:FunctionID.rfind('/')]
	Ffile = FunctionID[FunctionID.rfind('/')+1:]
	return CallNb, Fline, Fname, Ffile

def AddMainChart(CallChartString, DataMain):
	CallChartString += "\n\
			window.addEventListener('resize', DrawMainHist);\n\
		    google.charts.setOnLoadCallback(DrawMainHist);\n\
				\n\
		    function DrawMainHist() {\n\
		      var data = google.visualization.arrayToDataTable([\n\
          			['Functions', 'Number of calls'],\n\
          			" + DataMain + "]); \n\
				\n\
		      var view = new google.visualization.DataView(data);\n\
		      view.setColumns([0, 1,\n\
		      	{ 	calc: \"stringify\",\n\
					sourceColumn: 1,\n\
					type: \"string\",\n\
					role: \"annotation\"}\n\
				]);\n\
				\n\
		      var options = {\n\
		        title: \"Number of calls to instrumented functions\",\n\
		        hAxis: {\n\
		        	textStyle: {fontSize: 15},\n\
		        	slantedText:true,\n\
		        	slantedTextAngle:90,\n\
		        },\n\
		        legend: { position: \"none\" },\n\
		        bar: {groupWidth: 25},\n\
		        chartArea: {top: 30, left: \"25%\", width: \"60%\", height: \"100%\"},\n\
		        height: (data.getNumberOfRows() * 40) + 50,\n\
				annotations: {\n\
					textStyle: {\n\
						color: 'black',\n\
						fontSize: 15,\n\
						auraColor: 'transparent',\n\
					},\n\
					stem: { length: 0 }, \n\
					alwaysOutside: true,\n\
				},\n\
		      };\n\
				\n\
		    	var chart = new google.visualization.BarChart(document.getElementById(\"MainHist\"));\n\
		      \n\
		      	chart.draw(view, options);\n\
				\n\
  				google.visualization.events.addListener(chart, 'click', function(e) {\n\
				    var selection;\n\
				    if (e.targetID) {\n\
				      selection = e.targetID.split('#');\n\
				      if (selection[0].indexOf('vAxis') > -1) {\n\
				        DisplayFunctionInformations(data.getValue(parseInt(selection[selection.length - 1]), parseInt(selection[1])));\n\
				        location.hash = '#Calls'\n\
				      }\n\
				    }\n\
  				});\n\
		  }\n\
	"

	return CallChartString

def AddCallArgsChart(CallChartString, ChartID, DivID, RangeData, ExponentData, MantissaData):
	CallChartString += "\n\
		google.charts.setOnLoadCallback(function (){\n\
			$(\"#Link_" + ChartID +  "_Precisions\").one('mouseover', function (){ \n\
			 	window.addEventListener('resize', Draw_" + DivID + "_ArgsHist);\n\
				Draw_" + DivID + "_ArgsHist();\n\
			});\n\
		});\n\
		function Draw_" + DivID + "_ArgsHist() {\n\
		  		var data = google.visualization.arrayToDataTable([\n\
		  			['Argument Type', 'Range of values (log2)', '', '', ''],\n\
		  			" + RangeData + "], false);\n\
				\n\
		      	var view = new google.visualization.DataView(data);\n\
				\n\
		      	var options = {\n\
		        	title: \"Inputs/Ouptuts arguments range of values (pow2)\",\n\
		        	legend: 'value interval',\n\
		        	annotations: {\n\
						textStyle: {\n\
							color: 'black',\n\
							fontSize: 15,\n\
							auraColor: 'transparent',\n\
						},\n\
						stem: { length: 0 }, \n\
						alwaysOutside: true,\n\
					},\n\
					chartArea: {width: \"50%\", left: \"25%\"},\n\
					height: 150,\n\
					hAxis: {\n\
						 textPosition: 'none',\n\
					},\n\
					colors: ['#d5dc1a'],\n\
		      	};\n\
				\n\
				var element = document.getElementById(\"" + DivID + "RangeHist\");\n\
				if (element != null){\n\
			    	var chart = new google.visualization.CandlestickChart(element);\n\
			      	chart.draw(view, options);}\n\
				\n\
		  		var data = google.visualization.arrayToDataTable([\n\
		  			['IO','Exponent size'],\n\
		  			" + ExponentData + "]);\n\
				\n\
		      	var view = new google.visualization.DataView(data);\n\
				\n\
		      	view.setColumns([0, \n\
		      		1,\n\
		      		{calc: \"stringify\",\n\
					sourceColumn: 1,\n\
					type: \"string\",\n\
					role: \"annotation\"}\n\
				]);\n\
				\n\
		      	var options = {\n\
		        	title: \"Inputs/Ouptuts minmum and maximum eponent size\",\n\
		        	annotations: {\n\
						textStyle: {\n\
							color: 'black',\n\
							fontSize: 15,\n\
							auraColor: 'transparent',\n\
						},\n\
						stem: { length: 0 }, \n\
						alwaysOutside: true,\n\
					},\n\
					chartArea: {width: \"50%\", left: \"25%\"},\n\
					height: 150,\n\
					vAxis: { \n\
						viewWindow: { min: 0 , max: 14 }, \n\
					},\n\
					hAxis: {\n\
						 textPosition: 'none',\n\
					},\n\
					colors: ['#0F5C9B'],\n\
		      	};\n\
				\n\
				var element = document.getElementById(\""+ DivID + "ExponentHist\");\n\
				if (element != null){\n\
			    	var chart = new google.visualization.ColumnChart(element);\n\
			      	chart.draw(view, options);}\n\
				\n\
		  		var data = google.visualization.arrayToDataTable([\n\
		  			['IO','Mantissa size'],\n\
		  			" + MantissaData + "]);\n\
				\n\
		      	var view = new google.visualization.DataView(data);\n\
				\n\
		      	view.setColumns([0, \n\
		      		1,\n\
		      		{calc: \"stringify\",\n\
					sourceColumn: 1,\n\
					type: \"string\",\n\
					role: \"annotation\"}\n\
				]);\n\
				\n\
		      	var options = {\n\
		        	title: \"Inputs/Ouptuts minmum and maximum mantissa size\",\n\
		        	annotations: {\n\
						textStyle: {\n\
							color: 'black',\n\
							fontSize: 15,\n\
							auraColor: 'transparent',\n\
						},\n\
						stem: { length: 0 }, \n\
						alwaysOutside: true,\n\
					},\n\
					chartArea: {width: \"50%\", left: \"25%\"},\n\
					height: 300,\n\
					vAxis: { \n\
						viewWindow: { min: 0 , max: 54 }, \n\
					},\n\
					colors: ['#9B0500'],\n\
		      	};\n\
				\n\
				var element = document.getElementById(\""+ DivID + "MantissaHist\");\n\
				if (element != null){\n\
			    	var chart = new google.visualization.ColumnChart(element);\n\
			      	chart.draw(view, options);}\n\
				\n\
		}\n\
		"
	return CallChartString

def AddCallOpsChart(CallChartString, ChartID, DivID, OpsDoublePrec, OpsFloatPrec):
	CallChartString += "\n\
		google.charts.setOnLoadCallback(function (){\n\
			$(\"#Link_" + ChartID +  "_Precisions\").one('mouseover', function (){ \n\
			 	window.addEventListener('resize', Draw_" + DivID + "_OpsHist);\n\
				Draw_" + DivID + "_OpsHist();\n\
			});\n\
		});\n\
		function Draw_" + DivID + "_OpsHist() {\n\
		  		var data = google.visualization.arrayToDataTable([\n\
		  			['Type','Mantissa size', '', 'ExponentSize'],\n\
		  			"+ OpsDoublePrec +"]);\n\
				\n\
		      	var view = new google.visualization.DataView(data);\n\
				\n\
		      	view.setColumns([0, \n\
		      		1,\n\
		      		{calc: \"stringify\",\n\
					sourceColumn: 1,\n\
					type: \"string\",\n\
					role: \"annotation\"},\n\
					2,\n\
					3,\n\
					{calc: \"stringify\",\n\
					sourceColumn: 3,\n\
					type: \"string\",\n\
					role: \"annotation\"},\n\
				]);\n\
				\n\
		      	var options = {\n\
		        	title: \"Precison for internal operations in double precision\",\n\
		        	annotations: {\n\
						textStyle: {\n\
							color: 'black',\n\
							fontSize: 15,\n\
							auraColor: 'transparent',\n\
						},\n\
						stem: { length: 2 , color: 'transparent'}, \n\
						alwaysOutside: true,\n\
					},\n\
					chartArea: {width: \"50%\", left: \"25%\"},\n\
					height: 150,\n\
					hAxis: { \n\
						viewWindow: { min: 0 , max: 66 }, \n\
					},\n\
					vAxis: {\n\
						 textPosition: 'none',\n\
					},\n\
					isStacked: true,\n\
					colors: ['#9B0500','transparent','#0F5C9B'],\n\
		      	};\n\
				\n\
				var element = document.getElementById(\""+ DivID + "DoubleHist\");\n\
				if (element != null){\n\
			    	var chart = new google.visualization.BarChart(element);\n\
			      	chart.draw(view, options);}\n\
				\n\
		      	/* Internal Operations Float */\n\
				\n\
	  			var data = google.visualization.arrayToDataTable([\n\
		  			['Type','Mantissa size', '', 'ExponentSize'],\n\
		  			" + OpsFloatPrec + "]);\n\
				\n\
		      	var view = new google.visualization.DataView(data);\n\
				\n\
		      	view.setColumns([0, \n\
		      		1,\n\
		      		{calc: \"stringify\",\n\
					sourceColumn: 1,\n\
					type: \"string\",\n\
					role: \"annotation\"},\n\
					2,\n\
					3,\n\
					{calc: \"stringify\",\n\
					sourceColumn: 3,\n\
					type: \"string\",\n\
					role: \"annotation\"},\n\
				]);\n\
				\n\
		      	var options = {\n\
		        	title: \"Precison for internal operations in simple precision\",\n\
		        	annotations: {\n\
						textStyle: {\n\
							color: 'black',\n\
							fontSize: 15,\n\
							auraColor: 'transparent',\n\
						},\n\
						stem: { length: 2, color: 'transparent' }, \n\
						alwaysOutside: true,\n\
					},\n\
					chartArea: {width: \"50%\", left: \"25%\"},\n\
					height: 150,\n\
					hAxis: { \n\
						viewWindow: { min: 0 , max: 66 }, \n\
					},\n\
					vAxis: {\n\
						 textPosition: 'none',\n\
					},\n\
					isStacked: true,\n\
					colors: ['#9B0500','transparent','#0F5C9B'],\n\
		      	};\n\
				\n\
				var element = document.getElementById(\""+ DivID + "FloatHist\");\n\
				if (element != null){\n\
			    	var chart = new google.visualization.BarChart(element);\n\
			      	chart.draw(view, options);}\n\
				\n\
		}\n\
		"
	return CallChartString

if __name__ == "__main__":

	ReportString = "\n\
<!DOCTYPE html>\n\
<html>\n\
	<!-- HEAD -->\n\
	<head>\n\
		<meta charset=\"utf-8\" />\n\
		<title>Precision Exploration Report</title>\n\
		\n\
		<script type=\"text/javascript\" src=\"https://www.gstatic.com/charts/loader.js\"></script>\n\
		  <script src=\"https://code.jquery.com/jquery-3.5.0.js\"></script>\n\
		\n\
		<script>\n\
			google.charts.load(\"current\", {packages:['corechart']});\n\
		\n\
			/* Chart script */\n\
		\n\
			google.charts.setOnLoadCallback(HideAll);\n\
		\n\
			actualFunction = \"\";\n\
		\n\
			function DisplayFunctionInformations(ID){\n\
				if(actualFunction != \"\") {\n\
					var to_hide = document.getElementById(actualFunction);\n\
				 	to_hide.style.display = 'none';\n\
				}\n\
		\n\
				var to_display = document.getElementById(ID);\n\
				to_display.style.display = 'block';\n\
		\n\
				actualFunction = ID;\n\
			}\n\
		\n\
			function DisplayCallInformations(ChartID){\n\
				DivID = ChartID + \"Precisions\";\n\
		\n\
				var to_display = document.getElementById(DivID);\n\
				if (to_display != null){\n\
					if(to_display.style.display != 'none') {\n\
						to_display.style.display = 'none';\n\
					}else{\n\
						to_display.style.display = 'block';\n\
					}\n\
				}\n\
			}\n\
		\n\
			function HideAll(){\n\
			    var to_hide = document.getElementsByClassName(\"Precisions\");\n\
			    \n\
			    for(var i = 0; i < to_hide.length; i++){\n\
			        to_hide[i].style.display = \"none\";\n\
			    }\n\
		\n\
			    var to_hide = document.getElementsByClassName(\"FunctionInformations\");\n\
			    \n\
			    for(var i = 0; i < to_hide.length; i++){\n\
			        to_hide[i].style.display = \"none\";\n\
			    }\n\
			}\n\
		\n\
			function Popup(DivID){\n\
				w=open(\"\",'popup','scrollbars=no,resizable=yes');\n\
				\n\
				var style = document.getElementById(\"MainStyle\");\n\
				var clone = style.cloneNode(true);\n\
				w.document.head.appendChild(clone);\n\
				\n\
				var charts = document.getElementById(DivID);\n\
				var clone = charts.cloneNode(true);\n\
				w.document.body.appendChild(clone);\n\
				charts.style.display= \"none\";\n\
				\n\
			}\n\
		\n\
		</script>\n\
		\n\
		<style ID=\"MainStyle\">\n\
			body {\n\
				font-family: arial;\n\
				max-width: 1400px;\n\
				margin: auto;\n\
			}\n\
		\n\
			p {\n\
				text-align: justify;\n\
			}\n\
		\n\
			h1 {\n\
				text-align: center;\n\
			}\n\
		\n\
			.CallLink {\n\
				text-decoration: none;\n\
				color: black;\n\
			}\n\
		\n\
			.InfoLink {\n\
				text-decoration: none;\n\
				color: black;\n\
			}\n\
			.PrecNavBar {\n\
				display: flex;\n\
				width: 100%;\n\
				justify-content: space-around;\n\
				align-items: center;\n\
			}\n\
		\n\
			.InfoMessage {\n\
				width: 100%;\n\
				text-align: center;\n\
			}\n\
		\n\
			.PrecNavBar a {\n\
				text-decoration: none;\n\
				background-color: #BEBEBE;\n\
				color: black;\n\
				width: 33%;\n\
				text-align: center;\n\
				padding-top: 15px;\n\
				padding-bottom: 15px;\n\
			}\n\
		\n\
			.PrecNavBar a:hover {\n\
				color: white;\n\
				background-color: #808080;\n\
			}\n\
		\n\
		</style>\n\
	</head>\n\
		\n\
	<!-- BODY -->\n\
	<body>\n\
		\n\
		<h1 id=\"Home\">Precision Exploration Report</h1>\n\
		\n\
		<h2 id=\"Introduction\"> Introduction</h2>\n\
		\n\
		<p>\n\
			The role of this report is to present results of the precision exploration script of verificarlo. The given result is not the optimal precision configuration and is obtained by a simple dichotomic search. The internal operations, precision is given exclusively for functions compiled with verificarlo, input(s) and output(s) precision is given for every called function.\n\
		</p>\n\
		\n\
		<h2 id=\"Functions\"> Functions</h2>\n\
		\n\
		<p>\n\
			This graph presents called functions which use float or double, they are sorted by number of calls and you can access to precision results for a function by clicking on the desired label.\n\
		</p>\n\
		\n\
		<div id=\"MainHist\"></div>\n\
		\n\
		<h2 id=\"Calls\"> Functions Call Site</h2>\n\
		\n\
		<p>\n\
			When a function is selected, a list with call sites of the selected function appear. You can hide or show precision information for a call site by clicking on the desired item in the list. If the function has not been compiled with verficarlo, internal operations precision are not accessible. If a function doesn't have double or float arguments, arguments precision will not be accessible too. \n\
		</p>\n\
		\n\
		<!-- Function Calls -->\n\
		\n\
	</body>\n\
</html>\n\
	"

	DaraDir = "vfc_exp_data/"
	Arguments = DaraDir + "ArgumentsResults.csv"
	Operations = DaraDir + "OperationsResults.csv"
	All_Args = DaraDir + "BothArgsResults.csv"
	All_Ops = DaraDir + "BothOpsResults.csv"
	SA_Args_svg = DaraDir + "vfc_args_only.svg"
	SA_Ops_svg = DaraDir + "vfc_ops_only.svg"
	SA_All_svg = DaraDir + "vfc_args_ops.svg"
	Report_File = DaraDir + "vfc_precexp_report.html"
	
	if not os.path.exists(Arguments):
		print("{} not found".format(Arguments))
		exit(0)
	else:
		DataArgs = pd.read_csv(Arguments)

	if not os.path.exists(Operations):
		print("{} not found".format(Operations))
		exit(0)
	else:
		DataOps = pd.read_csv(Operations)

	if not os.path.exists(All_Args):
		print("{} not found".format(All_Args))
		exit(0)
	else:
		DataAllArgs = pd.read_csv(All_Args)

	if not os.path.exists(All_Ops):
		print("{} not found".format(All_Ops))
		exit(0)
	else:
		DataAllOps = pd.read_csv(All_Ops)

	if not os.path.exists(SA_Args_svg):
		print("{} not found".format(SA_Args_svg))
		exit(0)

	if not os.path.exists(SA_Ops_svg):
		print("{} not found".format(SA_Ops_svg))
		exit(0)

	if not os.path.exists(SA_All_svg):
		print("{} not found".format(SA_All_svg))
		exit(0)

	CallChartString = ""

	################ Functions List ################

	dict = {}
	dict_index = {}

	for i in DataAllOps.index:
		CallNb, Fline, Fname, Ffile = GetFunctionInfo(DataAllOps.at[i, 'ID'])

		if Fname in dict.keys():
			dict[Fname] += DataAllOps.at[i, 'Ncalls']
			dict_index[Fname].append(i)
		else:
			dict[Fname] = DataAllOps.at[i, 'Ncalls']
			dict_index[Fname] = [i]

	SortedFunctions = pd.DataFrame(dict.items(), columns=['function','ncalls']).sort_values(by = 'ncalls', ascending=False, ignore_index=True)

	DataMain = ""

	for i in SortedFunctions.index:
		DataMain += "['{Function}',{Ncalls}],\n".format(
						Function = SortedFunctions.at[i, 'function'].upper(),
						Ncalls = SortedFunctions.at[i, 'ncalls'])

	CallChartString = AddMainChart(CallChartString, DataMain)

	################ Function Calls ################

	FunctionCallsStr = ""

	for i in SortedFunctions.index:
		FunctionCallsStr += "<div ID=\"{Function}\" class=\"FunctionInformations\">\n".format(
			Function = SortedFunctions.at[i, 'function'].upper())

		tmp_ops = DataAllOps.copy()
		tmp_ops = tmp_ops.drop([x for x in tmp_ops.index if x not in dict_index[SortedFunctions.at[i, 'function']]])
		tmp_ops = tmp_ops.sort_values(by = 'Ncalls', ascending=False, ignore_index=True)

		for j in tmp_ops.index:
			CallNb, Fline, Fname, Ffile = GetFunctionInfo(tmp_ops.at[j, 'ID'])

			ChartID = Ffile.replace('.', '_') + "_" + Fname.replace('.', '_') + "_" + str(CallNb)
			RangeData = ""
			ExponentData = ""
			MantissaData = ""
			OpsDoublePrec = ""
			OpsFloatPrec = ""

			FunctionCallsStr += "\t\t\t<a ID=\"Link_" + ChartID +  "_Precisions\" href=\"#" + ChartID + "Precision\" onclick=\"DisplayCallInformations('"+ ChartID+ "'); \
							Popup(\'" + ChartID +  "Precisions\');\" class=\"InfoLink\"><h4>Call to {Fname} in {Ffile} at line {Fline} executed {Ncalls} time(s):</h4></a>\n".format(
				Fname = Fname.upper(),
				Ffile = Ffile,
				Fline = Fline,
				Ncalls = tmp_ops.at[j, 'Ncalls'])

			# Arguments and Operations
			FunctionCallsStr += "\t\t\t<div ID=\"" + ChartID +  "Precisions\" class=\"Precisions\">\n"

			FunctionCallsStr += "\t\t\t<div class=\"PrecNavBar\">\n"
			FunctionCallsStr += "\t\t\t<a href=\"#" + ChartID +  "ArgumentsOperationsPrecision\">Arguments and Operations</a>\n"
			FunctionCallsStr += "\t\t\t<a href=\"#" + ChartID +  "ArgumentsPrecision\">Arguments Only</a>\n"
			FunctionCallsStr += "\t\t\t<a href=\"#" + ChartID +  "OperationsPrecision\">Operations Only</a>\n"
			FunctionCallsStr += "\t\t\t</div>\n"

			FunctionCallsStr += "\t\t\t<div ID=\"" + ChartID +  "ArgumentsOperationsPrecision\" class=\"ArgumentsOperationsPrecision\">\n"
			FunctionCallsStr += "\t\t\t<h5>Arguments and Operations</h5>\n"

			ArgsOpsChartID = ChartID + "_ArgsOps";

			tmp_args = DataAllArgs.copy()
			tmp_args = tmp_args[tmp_args['ID'] == tmp_ops.at[j, 'ID']]
			for k in tmp_args.index:

				if tmp_args.at[k, 'Type'] == 0:
					RangeData += "['{IO}',{Min},{Min},{Max},{Max}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Float",
						Min = tmp_args.at[k, 'Min'] if tmp_args.at[k, 'Min'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Min'])),
						Max = tmp_args.at[k, 'Max'] if tmp_args.at[k, 'Max'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Max'])))
					ExponentData += "['{IO}',{Exponent}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Float",
						Exponent = tmp_args.at[k, 'Range'])
					MantissaData += "['{IO}',{Mantissa}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Float",
						Mantissa = tmp_args.at[k, 'Prec'])
				else :
					RangeData += "['{IO}',{Min},{Min},{Max},{Max}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Double",
						Min = tmp_args.at[k, 'Min'] if tmp_args.at[k, 'Min'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Min'])),
						Max = tmp_args.at[k, 'Max'] if tmp_args.at[k, 'Max'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Max'])))
					ExponentData += "['{IO}',{Exponent}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Double",
						Exponent = tmp_args.at[k, 'Range'])
					MantissaData += "['{IO}',{Mantissa}],\n".format(
						IO = tmp_args.at[k, 'IO'] + " - Double",
						Mantissa = tmp_args.at[k, 'Prec'],)
			if (tmp_ops.at[j, 'Ninputs'] + tmp_ops.at[j, 'Noutputs']) != 0:
				FunctionCallsStr += "\n\
				<div>\n\
					<h4 style=\"text-align: center;\">Arguments Precisions</h4>				\n\
					<div id=\"" + ArgsOpsChartID + "RangeHist\"></div>\n\
					<div id=\"" + ArgsOpsChartID + "ExponentHist\"></div>\n\
					<div id=\"" + ArgsOpsChartID + "MantissaHist\"></div>\n\
				</div>\n\
				"
				CallChartString = AddCallArgsChart(CallChartString, ChartID, ArgsOpsChartID, RangeData, ExponentData, MantissaData)

			OpsFloatPrec += "['Float',{Prec32},{Fill},{Range32}],\n".format(
				Prec32 = tmp_ops.at[j, 'Prec32'],
				Fill = 23 - tmp_ops.at[j, 'Prec32'],
				Range32 = tmp_ops.at[j, 'Range32'])

			OpsDoublePrec += "['Double',{Prec64},{Fill},{Range64}],\n".format(
				Prec64 = tmp_ops.at[j, 'Prec64'],
				Fill = 52 - tmp_ops.at[j, 'Prec64'],
				Range64 = tmp_ops.at[j, 'Range64'])

			if not (tmp_ops.at[j, 'Int'] or tmp_ops.at[j, 'Lib']):
				FunctionCallsStr += "\n\
				<div>\n\
				<h4 style=\"text-align: center;\">Internal Operations Precisions</h4>	\n\
				"
				if tmp_ops.at[j, 'Double']:
					FunctionCallsStr += "\n\
						<div id=\"" + ArgsOpsChartID + "DoubleHist\"></div>\n\
					"
				if tmp_ops.at[j, 'Float']:
					FunctionCallsStr += "\n\
						<div id=\"" + ArgsOpsChartID + "FloatHist\"></div>\n\
					"
				FunctionCallsStr += "\n\
				</div>																	\n\
				"
				CallChartString = AddCallOpsChart(CallChartString, ChartID, ArgsOpsChartID, OpsDoublePrec, OpsFloatPrec)

			FunctionCallsStr += "</div>\n"

			# Arguments Only
			FunctionCallsStr += "\t\t\t<div ID=\"" + ChartID +  "ArgumentsPrecision\" class=\"ArgumentsPrecision\">\n"
			if (tmp_ops.at[j, 'Ninputs'] + tmp_ops.at[j, 'Noutputs']) != 0:
				FunctionCallsStr += "\t\t\t<h5>Arguments Only</h5>\n"

				ArgsChartID = ChartID + "_Args";
				RangeData = ""
				ExponentData = ""
				MantissaData = ""

				tmp_args = DataArgs.copy()
				tmp_args = tmp_args[tmp_args['ID'] == tmp_ops.at[j, 'ID']]
				for k in tmp_args.index:

					if tmp_args.at[k, 'Type'] == 0:
						RangeData += "['{IO}',{Min},{Min},{Max},{Max}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Float",
							Min = tmp_args.at[k, 'Min'] if tmp_args.at[k, 'Min'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Min'])),
							Max = tmp_args.at[k, 'Max'] if tmp_args.at[k, 'Max'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Max'])))
						ExponentData += "['{IO}',{Exponent}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Float",
							Exponent = tmp_args.at[k, 'Range'])
						MantissaData += "['{IO}',{Mantissa}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Float",
							Mantissa = tmp_args.at[k, 'Prec'])
					else :
						RangeData += "['{IO}',{Min},{Min},{Max},{Max}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Double",
							Min = tmp_args.at[k, 'Min'] if tmp_args.at[k, 'Min'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Min'])),
							Max = tmp_args.at[k, 'Max'] if tmp_args.at[k, 'Max'] >= 0 else -math.log2(abs(tmp_args.at[k, 'Max'])))
						ExponentData += "['{IO}',{Exponent}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Double",
							Exponent = tmp_args.at[k, 'Range'])
						MantissaData += "['{IO}',{Mantissa}],\n".format(
							IO = tmp_args.at[k, 'IO'] + " - Double",
							Mantissa = tmp_args.at[k, 'Prec'],)

				FunctionCallsStr += "\n\
				<div>\n\
					<h4 style=\"text-align: center;\">Arguments Precisions</h4>	\n\
					<div id=\"" + ArgsChartID + "RangeHist\"></div>\n\
					<div id=\"" + ArgsChartID + "ExponentHist\"></div>\n\
					<div id=\"" + ArgsChartID + "MantissaHist\"></div>\n\
				</div>\n\
				"
				CallChartString = AddCallArgsChart(CallChartString, ChartID, ArgsChartID, RangeData, ExponentData, MantissaData)
			else:
				FunctionCallsStr += "\t\t\t<h5>Arguments Only</h5>\n"
				FunctionCallsStr += "<p class=\"InfoMessage\">It's looks like this function don't have float or double as arguments.</p>\n"
			FunctionCallsStr += "</div>\n"

			# Operations Only
			k = DataOps[DataOps['ID'] == tmp_ops.at[j, 'ID']].index[0]

			FunctionCallsStr += "\t\t\t<div ID=\"" + ChartID +  "OperationsPrecision\" class=\"OperationsPrecision\">\n"
			if not (DataOps.at[k, 'Int'] or DataOps.at[k, 'Lib']):
				FunctionCallsStr += "\t\t\t<h5>Operations Only</h5>\n"

				OpsChartID = ChartID + "_Ops";
				OpsDoublePrec = ""
				OpsFloatPrec = ""

				OpsFloatPrec += "['Float',{Prec32},{Fill},{Range32}],\n".format(
					Prec32 = DataOps.at[k, 'Prec32'],
					Fill = 23 - DataOps.at[k, 'Prec32'],
					Range32 = DataOps.at[k, 'Range32'])

				OpsDoublePrec += "['Double',{Prec64},{Fill},{Range64}],\n".format(
					Prec64 = DataOps.at[k, 'Prec64'],
					Fill = 52 - DataOps.at[k, 'Prec64'],
					Range64 = DataOps.at[k, 'Range64'])

				FunctionCallsStr += "\n\
				<div>\n\
				<h4 style=\"text-align: center;\">Internal Operations Precisions</h4>\n\
				"
				if DataOps.at[k, 'Double']:
					FunctionCallsStr += "\n\
						<div id=\"" + OpsChartID + "DoubleHist\"></div>\n\
					"
				if DataOps.at[k, 'Float']:
					FunctionCallsStr += "\n\
						<div id=\"" + OpsChartID + "FloatHist\"></div>\n\
					"
				FunctionCallsStr += "\n\
				</div>																	\n\
				"
				CallChartString = AddCallOpsChart(CallChartString, ChartID, OpsChartID, OpsDoublePrec, OpsFloatPrec)

			else:
				FunctionCallsStr += "\t\t\t<h5>Operations Only</h5>\n"
				FunctionCallsStr += "<p class=\"InfoMessage\">It's looks like this function have not been compiled with verificarlo and we can't access to internal operations.</p>\n"

			FunctionCallsStr += "</div>\n"
			FunctionCallsStr += "</div>\n"

		FunctionCallsStr += "</div>\n"

	FunctionCallsStr += "\n"
	
	ReportString = ReportString.replace('\t\t<!-- Function Calls -->', FunctionCallsStr)
	ReportString = ReportString.replace('\t\t\t/* Chart script */', CallChartString)

	ReportFile = open("report.html", "w")

	ReportString = ReportFile.write(ReportString)

	ReportFile.close()